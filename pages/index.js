import { useEffect, useState } from 'react'
import Head from 'next/head'
import { useSession } from 'next-auth/react'
import connection from '../utils/db'
import { Inter } from '@next/font/google'
import { signOut } from 'next-auth/react'
import Posts from './Posts'
import Link from 'next/link'

export default function Home({ posts }) {
	const { status, data } = useSession()

	if (status === 'unauthenticated')
		return (
			<>
				<Head>
					<title>Create Next App</title>
					<meta name="description" content="Generated by create next app" />
					<meta name="viewport" content="width=device-width, initial-scale=1" />
					<link rel="icon" href="/favicon.ico" />
				</Head>
				<Link href="/auth/signin">Log in </Link>
				<Link href="/auth/signup">Sign Up</Link>
				<Posts posts={posts} />
			</>
		)

	if (status === 'authenticated')
		return (
			<>
				<Head>
					<title>Create Next App</title>
					<meta name="description" content="Generated by create next app" />
					<meta name="viewport" content="width=device-width, initial-scale=1" />
					<link rel="icon" href="/favicon.ico" />
				</Head>
				<button
					onClick={() => {
						handleSignOut()
					}}
				>
					Log out
				</button>
				<h1>Hello {data.user.name}</h1>
				<Posts posts={posts} />
			</>
		)
}
const handleSignOut = async () => {
	const data = await signOut({ redirect: false, callbackUrl: '/' })
}
export async function getStaticProps() {
	const [usersPosts, fields] = await connection.promise().query('SELECT * FROM userposts')
	const posts = JSON.parse(JSON.stringify(usersPosts))
	return {
		props: {
			posts,
		},
	}
}
